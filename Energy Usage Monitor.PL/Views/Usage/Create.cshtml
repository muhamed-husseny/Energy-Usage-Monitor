@model DeviceUsageForCreationDto

@{
    ViewData["Title"] = "Add Device Usage";
}

<section class="max-w-2xl mx-auto mt-10 bg-gray-900 border border-gray-700 shadow-2xl rounded-2xl p-8 text-white">
    <h2 class="text-3xl font-bold text-red-600 mb-6 flex items-center gap-2">
        <i data-lucide="activity" class="w-6 h-6 text-red-600"></i>
        Add Device Usage
    </h2>

    <form asp-action="Create" method="post" class="space-y-6">
        <input type="hidden" asp-for="ElectricalDeviceId" />

        <div>
            <label asp-for="StartTime" class="block text-sm font-medium text-gray-300 mb-1">Start Time</label>
            <input asp-for="StartTime" type="datetime-local" class="w-full px-4 py-2 rounded-lg bg-gray-800 border border-gray-600 text-white focus:ring-2 focus:ring-red-500" />
            <span asp-validation-for="StartTime" class="text-red-500 text-sm mt-1 block"></span>
        </div>

        <div>
            <label asp-for="EndTime" class="block text-sm font-medium text-gray-300 mb-1">End Time</label>
            <input asp-for="EndTime" type="datetime-local" class="w-full px-4 py-2 rounded-lg bg-gray-800 border border-gray-600 text-white focus:ring-2 focus:ring-red-500" />
            <span asp-validation-for="EndTime" class="text-red-500 text-sm mt-1 block"></span>
        </div>


        <div>
            <label class="block text-sm font-medium text-gray-300 mb-1">Calculated Duration</label>
            <div id="durationDisplay" class="text-white font-medium bg-gray-800 px-4 py-2 rounded-lg border border-gray-700">
                Please select start and end times
            </div>
        </div>

        <div class="flex justify-between mt-8">
            <a asp-action="Index" asp-route-deviceId="@Model.ElectricalDeviceId" class="px-6 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 text-white font-semibold transition-all duration-200">
                Cancel
            </a>
            <button type="submit" class="px-6 py-2 rounded-lg bg-red-600 hover:bg-red-700 text-white font-semibold transition-all duration-200">
                Save Usage
            </button>
        </div>
    </form>
</section>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        if (window.lucide) lucide.createIcons();

        const startInput = document.querySelector("#StartTime");
        const endInput = document.querySelector("#EndTime");
        const durationDisplay = document.querySelector("#durationDisplay");

        function updateDuration() {
            const start = new Date(startInput.value);
            const end = new Date(endInput.value);

            if (isNaN(start) || isNaN(end)) {
                durationDisplay.textContent = "Please select start and end times";
                return;
            }

            if (end <= start) {
                durationDisplay.textContent = "❌ End time must be after start time";
                durationDisplay.classList.add("text-red-500");
                return;
            }

            const durationMs = end - start;
            const hours = durationMs / 1000 / 60 / 60;
            durationDisplay.textContent = `✅ Duration: ${hours.toFixed(2)} hours`;
            durationDisplay.classList.remove("text-red-500");
        }

        startInput.addEventListener("change", updateDuration);
        endInput.addEventListener("change", updateDuration);
    </script>
}
